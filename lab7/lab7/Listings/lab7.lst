C51 COMPILER V9.60.7.0   LAB7                                                              03/10/2024 16:52:38 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE LAB7
OBJECT MODULE PLACED IN .\Objects\lab7.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE lab7.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\lab7
                    -.lst) TABS(2) OBJECT(.\Objects\lab7.obj)

line level    source

   1          #include <at89c5131.h>
   2          sbit R0=P3^4;
   3          sbit R1=P3^5;
   4          sbit R2=P3^6;
   5          sbit R3=P3^7;
   6          sbit C0=P3^3;
   7          sbit C1=P3^2;
   8          sbit C2=P3^1;
   9          sbit C3=P3^0;
  10          sbit RS=P0^0; //Register select
  11          sbit RW=P0^1; //Read from or write to register
  12          sbit EN=P0^2;
  13          int a;
  14          void lcd_init(void);                                        //Initialize LCD
  15          void lcd_cmd(unsigned int i);     
  16          void Check_release(void);
  17          void msdelay(unsigned int time);
  18          int check_rnc(void);
  19          void lcd_write_char(unsigned char ch);
  20          int key;
  21          void main()
  22          
  23          
  24          {while(1)
  25   1      {
  26   2        P3=0X0F;
  27   2        Check_release();
  28   2        if(P3!=0X0F)
  29   2        {
  30   3          msdelay(20);
  31   3          if(P3==0X0F)
  32   3          {
  33   4            Check_release();
  34   4          }
  35   3          else
  36   3          {
  37   4            key=check_rnc();
  38   4          }
  39   3          
  40   3        }
  41   2        else
  42   2        {Check_release();}
  43   2        lcd_init();
  44   2        lcd_cmd(0x80);                          //Move cursor to first line
  45   2        msdelay(4);
  46   2        lcd_write_char(48+key);
  47   2        
  48   2        
  49   2      } 
  50   1        }
  51          
  52          void Check_release(void)
  53          {
  54   1          while(P3!=0X0F)
C51 COMPILER V9.60.7.0   LAB7                                                              03/10/2024 16:52:38 PAGE 2   

  55   1            {a=2;
  56   2      }
  57   1      }
  58          
  59          void msdelay(unsigned int time)
  60          {
  61   1        int i,j;
  62   1        for(i=0;i<time;i++)
  63   1        {
  64   2          for(j=0;j<382;j++);
  65   2        }
  66   1      }
  67          
  68          int check_rnc(void)
  69          {
  70   1        P3=0X7F;
  71   1        if(P3==0X7F)
  72   1        {
  73   2          P3=0XbF;
  74   2            if(P3==0XbF)
  75   2          {
  76   3            P3=0XdF;
  77   3              if(P3==0XdF)
  78   3               {
  79   4                  P3=0XeF;
  80   4                  if(P3==0XeF)
  81   4                  {
  82   5                   Check_release();
  83   5                  }
  84   4                  else
  85   4                  {
  86   5                    if(P3==0Xee)
  87   5                    {key=0x01;}
  88   5                    else if(P3==0Xed)
  89   5                    {key=0x02;}
  90   5                    else if(P3==0Xeb)
  91   5                    {key=0x03;}
  92   5                    else if(P3==0Xe7)
  93   5                    {key=0x04;} 
  94   5                  }
  95   4          
  96   4               }
  97   3              else
  98   3              {
  99   4                
 100   4                    if(P3==0Xde)
 101   4                    {key=0x05;}
 102   4                    else if(P3==0Xdd)
 103   4                    {key=0x06;}
 104   4                    else if(P3==0Xdb)
 105   4                    {key=0x07;}
 106   4                    else if(P3==0Xd7)
 107   4                    {key=0x08;} 
 108   4              } 
 109   3            
 110   3            
 111   3          }
 112   2        else
 113   2        {
 114   3          
 115   3                    if(P3==0Xbe)
 116   3                    {key=0x09;}
C51 COMPILER V9.60.7.0   LAB7                                                              03/10/2024 16:52:38 PAGE 3   

 117   3                    else if(P3==0Xbd)
 118   3                    {key=0x0a;}
 119   3                    else if(P3==0Xbb)
 120   3                    {key=0x0b;}
 121   3                    else if(P3==0Xb7)
 122   3                    {key=0x0c;} 
 123   3        }
 124   2        }
 125   1        else
 126   1        {
 127   2          
 128   2                    if(P3==0X7e)
 129   2                    {key=0x0d;}
 130   2                    else if(P3==0X7d)
 131   2                    {key=0x0e;}
 132   2                    else if(P3==0X7b)
 133   2                    {key=0x0f;}
 134   2                    else if(P3==0X77)
 135   2                    {key=0x10;} 
 136   2        }
 137   1        return key;
 138   1      }
 139          
 140          
 141          void lcd_write_char(unsigned char ch)
 142          {
 143   1        RS=1;
 144   1        RW=0;
 145   1        EN=1;
 146   1        P2=ch;
 147   1        msdelay(10);
 148   1        EN=0;
 149   1      }
 150          void lcd_init(void)
 151          {
 152   1        P2=0x00;
 153   1        EN=0;
 154   1        RS=0;
 155   1        RW=0;
 156   1        
 157   1        lcd_cmd(0x38);  // Function set: 2 Line, 8-bit, 5x7 dots
 158   1        msdelay(4);
 159   1        lcd_cmd(0x06);  // Entry mode, auto increment with no shift
 160   1        msdelay(4);
 161   1        lcd_cmd(0x0C);  // Display on, Curson off
 162   1        msdelay(4);
 163   1        lcd_cmd(0x01);  // LCD clear
 164   1        msdelay(4);
 165   1        lcd_cmd(0x80);  //Move cursor to Row 1 column 0
 166   1      }
 167          
 168          void lcd_cmd(unsigned int i)
 169          {
 170   1        RS=0;
 171   1        RW=0;
 172   1        EN=1;
 173   1        P2=i;
 174   1        msdelay(10);
 175   1        EN=0;
 176   1      }


C51 COMPILER V9.60.7.0   LAB7                                                              03/10/2024 16:52:38 PAGE 4   

MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    462    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
